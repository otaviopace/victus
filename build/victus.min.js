// victus | (c) 2020 sporeball | MIT license
!function(){var t,s,h,e,o,r=Math.PI,l=Object;class n{constructor(t,s,i,h,e){this.x=t,this.y=s,this.w=i,this.h=h,this.xv=this.yv=this.rotation=0,this.anchorX=this.w/2,this.anchorY=this.h/2,this.hidden=0,this.setProps(e)}moveTo(t,s){this.x=t,this.y=s}moveBy(t,s){this.x+=t,this.y+=s}anchor(t,s){this.anchorX=t,this.anchorY=s}hide(){this.hidden=1}show(){this.hidden=0}setProps(t){Object.assign(this,t)}clone(t){let s=c(this);return s.setProps(t),s}draw(){this.moveBy(this.xv,this.yv),this.ax=this.x+this.anchorX,this.ay=this.y+this.anchorY,s.save(),s[c="translate"](this.ax,this.ay),s.rotate(this.rotation*(r/180)),s[c](-this.ax,-this.ay),this.hidden||this._(),s.restore()}}var a={Left:"ArrowLeft",Up:"ArrowUp",Right:"ArrowRight",Down:"ArrowDown"};[..."ABCDEFGHIJKLMNOPQRSTUVWXYZ"].map(t=>a[t]="Key"+t);var d={x:0,y:0,click:0,held:0};document.onmousemove=t=>{d.x=t.pageX,d.y=t.pageY},document.onmousedown=t=>{1==t.which&&(d.held||(d.click=1),d.held=1)},document.onmouseup=t=>{1==t.which&&(d.held=0)},c=t=>{let s;if("object"!=typeof t)return t;for(i in s=l.create(l.getPrototypeOf(t)),t)s[i]=c(t[i]);return s},k=(t=0,i=0,r=h,c=e,l=o)=>{s.fillStyle=l,s.fillRect(t,i,r,c)},x=t=>s,this.victus={setup:i=>{t=document.getElementById(i.id),s=t.getContext`2d`,h=t.width=i.w,e=t.height=i.h,o=i.color||"#fff"},Rect:class extends n{constructor(t,s,i,h,e,o){super(t,s,i,h,o),this.col=e}_(){k(this.x,this.y,this.w,this.h,this.col)}},Ellipse:class extends n{constructor(t,s,i,h,e,o){super(t,s,i,h,o),this.col=e}_(){s.fillStyle=this.col,s.beginPath(),s.ellipse(this.x,this.y,this.w,this.h,0,0,2*r),s.closePath(),s.fill()}},Sprite:class extends n{constructor(t,s,i,h,e,o){super(s,i,h,e,o),this.spr=t,this.d=new Image,this.d.src=this.spr}_(){s.drawImage(this.d,this.x,this.y,this.w,this.h)}},Text:class extends n{constructor(t,s,i,h=16,e="#000",o="Arial",r="left"){super(s,i),this.str=t,this.size=h,this.col=e,this.font=o,this.align=r}_(){s.fillStyle=this.col,s.font=this.size+"px "+this.font,s.textAlign=this.align,s.fillText(this.str,this.x,this.y)}},Sound:class{constructor(t,s,i=0){this.vol=s,this.d=new Audio(t),this.d.loop=i}reset(){this.d.load()}play(){this.reset(),this.d.volume=this.vol,this.d.play()}pause(){this.d.pause()}},clear:k,keys:a,mouse:d}}();